<template>
  <div>
    <form>
      <div class="form-group">
        <label for="InputOrgCode">机构编码</label>
        <input type="text" class="form-control" placeholder="OrgCode" v-model="OrgInfo.code" @input="orgs()" id ="InputOrgCode">
      </div>
      <div class="form-group">
        <label for="InputOrgName">机构名称</label>
        <input type="text" class="form-control" placeholder="OrgName" v-model="OrgInfo.name" @input="orgs()" id ="InputOrgName">
      </div>
      <div class="form-group">
        <label for="InputOrgLevel">机构等级</label>
        <input type="text" class="form-control" placeholder="OrgLevel" v-model="OrgInfo.level" @input="orgs()" id ="InputOrgLevel">
      </div>
      <div class="form-group">
        <label for="InputOrgType">机构类别</label>
        <input type="text" class="form-control" placeholder="OrgType" v-model="OrgInfo.type" @input="orgs()" id ="InputOrgType">
      </div>
      <div class="form-group">
        <!-- <label for="InputOrgProvince">省份</label> -->
        <label for="InputOrgProvince">省份</label>
          <select class="form-control" id="InputOrgProvince" v-model="OrgInfo.province" @input="orgs()">
             <option v-for="(value, index) in provinceAll.province" v-bind:key="index" v-bind:id="'server-org-province-tr'+index">{{value}}</option>
          </select>
        <!-- <input type="text" class="form-control" placeholder="Province" v-model="OrgInfo.province"> -->
      </div>
      <div class="form-group">
        <label for="InputOrgCity">市</label>
          <select class="form-control" id="InputOrgCity" v-model="OrgInfo.city" @input="orgs()">
            <option v-for="(value, index) in provinceAll.city[OrgInfo.province]" v-bind:key="index" v-bind:id="'server-org-city-tr'+index">{{value}}</option>
          </select>
        <!-- <label for="InputOrgCity">市</label>
        <input type="text" class="form-control" placeholder="City" v-model="OrgInfo.city"> -->
      </div>
      <div class="form-group">
        <label for="InputOrgCity">机构县</label>
        <select class="form-control" id="InputOrgCity" v-model="OrgInfo.county" @input="orgs()">
          <option v-for="(value, index) in provinceAll.county[OrgInfo.city]" v-bind:key="index" v-bind:id="'server-org-county-tr'+index">{{value}}</option>
        </select>
        <!-- <label for="InputOrgCounty">机构县</label>
        <input type="text" class="form-control" placeholder="County" v-model="OrgInfo.county"> -->
      </div>
      <div class="form-group">
        <label for="InputOrgPerson_name">联系人</label>
        <input type="text" class="form-control" placeholder="Person_name" v-model="OrgInfo.person_name" @input="orgs()" id = "InputOrgPerson_name">
      </div>
      <div class="form-group">
        <label for="InputOrgTel">联系电话</label>
        <input type="text" class="form-control" placeholder="Tel" v-model="OrgInfo.tel" @input="orgs()" id = "InputOrgTel">
      </div>
      <div class="form-group">
        <label for="InputOrgEmail">Email</label>
        <input type="email" class="form-control" placeholder="Email" v-model="OrgInfo.email" @input="orgs()" id = "InputOrgEmail">
      </div>
    </form>
    <button v-if="toolbar === 'createOrgs' && orgPage === 'getOrg' && orgName ==='update'" v-on:click="updateOrg()">机构修改</button>
    <button v-if="toolbar === 'createOrgs' && orgPage === 'getOrg' && orgName ==='insert'" id = "server-user-addorg"  v-on:click="insertOrg()">添加机构</button>
    <div class="row">
      <div class="col-9" />
    </div>
  </div>
</template>
<script>
  import { sUpdateOrg, sCreateOrg } from '../../../utils/ServerUser';
  export default {
    data() {
      return {
        OrgInfo: {
          code: this.$store.state.System.orgInfo.code,
          name: this.$store.state.System.orgInfo.name,
          level: this.$store.state.System.orgInfo.level,
          type: this.$store.state.System.orgInfo.type,
          province: this.$store.state.System.orgInfo.province,
          city: this.$store.state.System.orgInfo.city,
          county: this.$store.state.System.orgInfo.county,
          person_name: this.$store.state.System.orgInfo.person_name,
          tel: this.$store.state.System.orgInfo.tel,
          email: this.$store.state.System.orgInfo.email
        }
      }
    },
    computed: {
      provinceAll: {
        get() {
          return this.$store.state.System.province
        }
      },
      orgPage: {
        get() {
          return this.$store.state.System.orgPage
        }
      },
      orgName: {
        get() {
          return this.$store.state.System.orgName
        }
      },
      toolbar: {
        get() {
          return this.$store.state.System.toolbar
        }
      }
    },
    methods: {
      insertOrg: function () {
        const reg = [/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g, /^1[0-9]{10}$/]
        let a = 1
        let b = 1
        if (reg[0].test(this.orgInfo.email)) {
          a = 1
        } else {
          a = 0
          this.$store.commit('SET_NOTICE', '邮箱输入错误');
        }
        if (reg[1].test(this.orgInfo.tel)) {
          b = 1
        } else {
          b = 0
          this.$store.commit('SET_NOTICE', '电话输入错误');
        }
        if (a * b === 1) {
          sCreateOrg(this, [this.$store.state.System.server, this.$store.state.System.port], this.orgInfo)
        }
      },
      orgs: function () {
        const b = {
          code: this.OrgInfo.code,
          name: this.OrgInfo.name,
          level: this.OrgInfo.level,
          type: this.OrgInfo.type,
          province: this.OrgInfo.province,
          city: this.OrgInfo.city,
          county: this.OrgInfo.county,
          person_name: this.OrgInfo.person_name,
          tel: this.OrgInfo.tel,
          email: this.OrgInfo.email
        }
        this.$store.commit('SYSTEM_GET_ORG_INFO', b);
      },
      updateOrg: function () {
        sUpdateOrg(this, [this.$store.state.System.server, this.$store.state.System.port], this.orgId, this.orgInfo)
      },
    }
  }
</script>
